---
title: 【设计模式】原型模式
date: 2020-11-20 16:25:23
tags:
- 设计模式
categories:
- coding
---

本文是设计模式系列文章之一的「原型模式」。

<!--more-->

原型模式是利用已经存在的对象复制一个新的对象，而不是直接调用类的构造函数来创建新的对象。

## 原型模式的实现
```php
<?php

interface Prototype
{
    public function clone();
}

class A implements Prototype
{
    public function __construct()
    {
        // 这里有一大堆代码要执行
    }

    public function clone()
    {
        $obj = clone $this;
    	return $obj;
    }
}
```

以上的代码中 A 类就应用了原型模式。使用者就可以不通过构造函数进行对象复制：
```php
<?php

$a1 = new A();
$a2 = $a->clone();
```

从上面的示例代码来看，原型模式是非常简单的。但是值得注意的是，像以上的方式只是实现了对象的浅拷贝。有些时候只需要浅拷贝即可，但有些时候需要进行深拷贝（deep copy）。因为有些场景不同的对象可以共同拥有相同的引用对象属性，有些场景则不行，所以要具体的场景具体分析，这超出了原型模式的范畴，因为设计模式只是提供一种思想和代码的基本实现框架。

不同的语言有不同的方式实现深拷贝，例如 PHP 有一个库名叫 [myclabs/deep-copy](https://github.com/myclabs/DeepCopy)。在每一种语言中实现深拷贝都不是一件轻而易举的事，有很多的 corner case 需要注意，必要时直接使用知名的开源库即可。

## 基于原型的编程范式

原型模式这种设计设计模式的背后，是「基于原型」的编程范式。当要创建一个新的对象时，要么通过类的构造函数来创建；要么通过复制已有的对象，或者扩展空对象来创建。JavaScript 的「类」就是以基于原型的方式来实现的。当要使用一个属性或方法的时候，如果在对象自身中找不到，就从它的原型链里面找。这种编程范式意味着既有复用性，又兼备灵活性——可以在对象中灵活地添加属性和方法。

## 总结

原型模式背后的设计思想就是基于现有的对象创建新对象。在像 PHP 这种基于类的语言中，这样做的好处主要是当类的构造函数中要做的事情非常复杂的时候，利用原型模式可以省去这个过程。原型模式需要注意的是要区分和理解浅拷贝和深拷贝，当对象的属性中存在引用类型，或者循环引用的时候，要小心处理。
