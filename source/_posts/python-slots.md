---
title: 关于 Python 的 __slots__
date: 2016-08-19 10:54:00
updated: 2016-08-19 10:54:00
tags:
- Python
categories:
- coding
---

这篇文章简单说下 Python 的 \_\_slots\_\_ 的用法和优缺点。
<!--more-->


## 用法
指定一个名为 \_\_slots\_\_ 的类属性，\_\_slots\_\_ 是一个每个元素都为 str 的 iterable，每个元素表示一个实例属性的名称。这个设置只影响实例的属性，不影响类属性。

## 使用\_\_slots\_\_的好处

默认情况下，Python 解释器将每个类实例的属性存储在一个名为 \_\_dict\_\_ 的dict里面，使用 dict的 话会有点overhead。使用 \_\_slots\_\_ 的话就可以让 Python 解释器使用别的结构代替 dict 来存储各个实例的属性信息。例如可以用 tuple 来代替。

如果程序里面某个类有**大量**的对象，就可以通过设置 \_\_slots\_\_ 来节省大量的内存，执行效率也会提高。

## 使用\_\_slots\_\_的局限
- 如果类 A 设置了 \_\_slots\_\_，类 B 继承了类 A，但类 B 是不会继承 A 的 \_\_slots\_\_ 设置的，必须在 B 里面重新设置
- 类的实例只能使用 slots 里面指定的那几个名称的属性（当然有解决方法是把 \_\_dict\_\_ 放进 \_\_slots\_\_ 里面，但这样就没意思了）
- 实例不能指定为「弱引用」，解决方法是把 \_\_weakref\_\_ 加到 \_\_slots\_\_ 里面

## 综述
slots 适用于那种有大量（几十几百万？）实例对象存在，而且每个实例的属性都是固定不变的场景，否则的话没必要用 slots，不会有太大提升。所以没必要盲目使用 slots，确定好瓶颈所在再用也不迟。

另外一点是，虽然 slots 可以起到限制实例属性的作用，但这个并不应该成为使用 slots 的目的。

以上。
